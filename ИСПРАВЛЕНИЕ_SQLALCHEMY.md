# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï SQLALCHEMY –ö–û–ù–¢–ï–ö–°–¢–ê

## ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞:**
```
RuntimeError: The current Flask app is not registered with this 'SQLAlchemy' instance. 
Did you forget to call 'init_app', or did you create multiple 'SQLAlchemy' instances?
```

## üîç **–ü—Ä–∏—á–∏–Ω–∞:**
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–≤—É—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (`db_pro` –∏ `db_mama`) –≤–æ–∑–Ω–∏–∫ **–∫–æ–Ω—Ñ–ª–∏–∫—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**:
- SQLAlchemy –Ω–µ –∑–Ω–∞–ª, –∫–∞–∫–æ–µ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- –ö–∞–∂–¥–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—ã–ª–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —Å–≤–æ–µ–º—É Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞

## ‚úÖ **–†–µ—à–µ–Ω–∏–µ:**

### **1. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –°–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –±–∞–∑—ã
app_pro, db_pro = create_app_database('pro')
app_mama, db_mama = create_app_database('mama')

# –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
app = app_pro
db = db_pro
```

### **2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```python
# –ü–†–ê–í–ò–õ–¨–ù–û - —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
with app_mama.app_context():
    user = db_mama.session.query(User).filter_by(login=login).first()

# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
user = db_mama.session.query(User).filter_by(login=login).first()
```

### **3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

#### **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:**
```python
@app.route('/register', methods=['GET', 'POST'])
def register():
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if app_type == 'mama':
        with app_mama.app_context():
            existing_user = db_mama.session.query(User).filter_by(login=login).first()
    else:
        with app_pro.app_context():
            existing_user = db_pro.session.query(User).filter_by(login=login).first()
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if user_type == 'user' and app_type == 'mama':
        with app_mama.app_context():
            new_user = User(...)
            db_mama.session.add(new_user)
            db_mama.session.commit()
```

#### **–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É:**
```python
@app.route('/login', methods=['GET', 'POST'])
def login():
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –æ–±–µ–∏—Ö –±–∞–∑–∞—Ö
    with app_pro.app_context():
        user = db_pro.session.query(User).filter_by(login=login).first()
        if user:
            app_type = 'pro'
    
    if not user:
        with app_mama.app_context():
            user = db_mama.session.query(User).filter_by(login=login).first()
            if user:
                app_type = 'mama'
```

#### **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```python
@login_manager.user_loader
def load_user(user_id):
    user = None
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º Pro –±–∞–∑—É
    with app_pro.app_context():
        user = db_pro.session.query(User).get(int(user_id))
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º Mama –±–∞–∑—É
    if not user:
        with app_mama.app_context():
            user = db_mama.session.query(User).get(int(user_id))
    
    return user
```

## üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚ùå `RuntimeError` –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SQLAlchemy
- ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –¥–≤—É–º—è –±–∞–∑–∞–º–∏
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SQLAlchemy
- ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–π –±–∞–∑—ã

## üöÄ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- ‚úÖ –ö–∞–∂–¥–∞—è –±–∞–∑–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–≤–æ–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É –±–∞–∑–∞–º–∏
- ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

### **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –±–∞–∑—ã
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ –º–æ–¥—É–ª–µ–π
- ‚úÖ –ì–∏–±–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## üìã **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

### **–õ–æ–∫–∞–ª—å–Ω–æ:**
```bash
python run_local.py
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:5001
# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ –æ–±–µ–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
```

### **–ù–∞ –¥–µ–ø–ª–æ–µ:**
- ‚úÖ –¢–∞ –∂–µ –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Railway
- ‚úÖ PostgreSQL —Å—Ö–µ–º—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

**üéâ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!**

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å **–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç** —Å –¥–≤—É–º—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –∏ **–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏ SQLAlchemy**.
