{% extends "admin/base.html" %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç</h1>
        <a href="{{ url_for('admin_mama_content') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏
        </a>
    </div>

    <!-- –§–æ—Ä–º–∞ -->
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏</h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
                        <div class="form-group">
                            <label for="title"><strong>–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏:</strong></label>
                            <input type="text" class="form-control" id="title" name="title" 
                                   value="{{ content.title }}" required>
                        </div>

                        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
                        <div class="form-group">
                            <label for="category"><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong></label>
                            <select class="form-control" id="category" name="category" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                {% for key, name in categories.items() %}
                                <option value="{{ key }}" {% if content.category == key %}selected{% endif %}>
                                    {% if key == 'sport' %}üèÉ {{ name }}
                                    {% elif key == 'nutrition' %}üçé {{ name }}
                                    {% elif key == 'vitamins' %}üíä {{ name }}
                                    {% elif key == 'body_care' %}üíÖ {{ name }}
                                    {% elif key == 'baby_care' %}üë∂ {{ name }}
                                    {% elif key == 'doctor_advice' %}üë®‚Äç‚öïÔ∏è {{ name }}
                                    {% else %}{{ name }}
                                    {% endif %}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- –¢—Ä–∏–º–µ—Å—Ç—Ä -->
                        <div class="form-group">
                            <label for="trimester"><strong>–¢—Ä–∏–º–µ—Å—Ç—Ä –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏:</strong></label>
                            <select class="form-control" id="trimester" name="trimester">
                                <option value="">–õ—é–±–æ–π —Ç—Ä–∏–º–µ—Å—Ç—Ä</option>
                                <option value="1" {% if content.trimester == '1' %}selected{% endif %}>1 —Ç—Ä–∏–º–µ—Å—Ç—Ä (1-12 –Ω–µ–¥–µ–ª—è)</option>
                                <option value="2" {% if content.trimester == '2' %}selected{% endif %}>2 —Ç—Ä–∏–º–µ—Å—Ç—Ä (13-27 –Ω–µ–¥–µ–ª—è)</option>
                                <option value="3" {% if content.trimester == '3' %}selected{% endif %}>3 —Ç—Ä–∏–º–µ—Å—Ç—Ä (28-40 –Ω–µ–¥–µ–ª—è)</option>
                                <option value="all" {% if content.trimester == 'all' %}selected{% endif %}>–õ—é–±–æ–π —Ç—Ä–∏–º–µ—Å—Ç—Ä</option>
                            </select>
                        </div>

                        <!-- –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ -->
                        <div class="form-group">
                            <label for="difficulty_level"><strong>–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</strong></label>
                            <select class="form-control" id="difficulty_level" name="difficulty_level">
                                <option value="">–ù–µ —É–∫–∞–∑–∞–Ω–æ</option>
                                <option value="easy" {% if content.difficulty_level == 'easy' %}selected{% endif %}>–õ–µ–≥–∫–∏–π</option>
                                <option value="medium" {% if content.difficulty_level == 'medium' %}selected{% endif %}>–°—Ä–µ–¥–Ω–∏–π</option>
                                <option value="hard" {% if content.difficulty_level == 'hard' %}selected{% endif %}>–°–ª–æ–∂–Ω—ã–π</option>
                            </select>
                        </div>

                        <!-- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
                        <div class="form-group">
                            <label for="duration"><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π):</strong></label>
                            <input type="text" class="form-control" id="duration" name="duration" 
                                   value="{{ content.duration or '' }}" 
                                   placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 15 –º–∏–Ω—É—Ç, 30 –º–∏–Ω—É—Ç">
                        </div>

                        <!-- –ê–≤—Ç–æ—Ä -->
                        <div class="form-group">
                            <label for="author"><strong>–ê–≤—Ç–æ—Ä:</strong></label>
                            <input type="text" class="form-control" id="author" name="author" 
                                   value="{{ content.author or '' }}" 
                                   placeholder="–ò–º—è –∞–≤—Ç–æ—Ä–∞">
                        </div>

                        <!-- –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ -->
                        <div class="form-group">
                            <label for="content"><strong>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏:</strong></label>
                            <textarea class="form-control" id="content" name="content" rows="10" required
                                      placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏...">{{ content.content }}</textarea>
                        </div>

                        <!-- –ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="image_url"><strong>URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</strong></label>
                                    <input type="url" class="form-control" id="image_url" name="image_url" 
                                           value="{{ content.image_url or '' }}"
                                           placeholder="https://example.com/image.jpg">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="video_url"><strong>URL –≤–∏–¥–µ–æ:</strong></label>
                                    <input type="url" class="form-control" id="video_url" name="video_url" 
                                           value="{{ content.video_url or '' }}"
                                           placeholder="https://youtube.com/watch?v=...">
                                </div>
                            </div>
                        </div>

                        <!-- –°—Ç–∞—Ç—É—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ -->
                        <div class="form-group">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="is_published" name="is_published"
                                       {% if content.is_published %}checked{% endif %}>
                                <label class="custom-control-label" for="is_published">
                                    <strong>–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é</strong>
                                </label>
                            </div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ -->
                        <div class="form-group">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                            </button>
                            <a href="{{ url_for('admin_mama_content') }}" class="btn btn-secondary">
                                –û—Ç–º–µ–Ω–∞
                            </a>
                            <button type="button" class="btn btn-danger" onclick="deleteContent()">
                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—å–µ -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—å–µ</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>ID:</strong> {{ content.id }}
                    </div>
                    <div class="mb-3">
                        <strong>–°–æ–∑–¥–∞–Ω–æ:</strong> {{ content.created_at.strftime('%d.%m.%Y %H:%M') }}
                    </div>
                    <div class="mb-3">
                        <strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> {{ content.updated_at.strftime('%d.%m.%Y %H:%M') }}
                    </div>
                    <div class="mb-3">
                        <strong>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã:</strong> {{ content.views }}
                    </div>
                    <div class="mb-3">
                        <strong>–°—Ç–∞—Ç—É—Å:</strong>
                        {% if content.is_published %}
                        <span class="badge badge-success">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</span>
                        {% else %}
                        <span class="badge badge-warning">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5><i class="fas fa-eye"></i> –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h5>
                </div>
                <div class="card-body">
                    <h6>{{ content.title }}</h6>
                    <p class="small">{{ content.content[:150] }}{% if content.content|length > 150 %}...{% endif %}</p>
                    
                    <div class="meta-info">
                        {% if content.trimester %}
                        <span class="badge badge-info">–¢—Ä–∏–º–µ—Å—Ç—Ä: {{ content.trimester }}</span>
                        {% endif %}
                        {% if content.difficulty_level %}
                        <span class="badge badge-secondary">–°–ª–æ–∂–Ω–æ—Å—Ç—å: {{ content.difficulty_level }}</span>
                        {% endif %}
                        {% if content.duration %}
                        <span class="badge badge-success">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {{ content.duration }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5><i class="fas fa-bolt"></i> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
                </div>
                <div class="card-body">
                    <div class="btn-group-vertical w-100">
                        <button type="button" class="btn btn-outline-primary mb-2" onclick="duplicateContent()">
                            <i class="fas fa-copy"></i> –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button type="button" class="btn btn-outline-info mb-2" onclick="previewContent()">
                            <i class="fas fa-eye"></i> –ü–æ–ª–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                        </button>
                        <button type="button" class="btn btn-outline-warning mb-2" onclick="togglePublish()">
                            <i class="fas fa-toggle-on"></i> 
                            {% if content.is_published %}–°–Ω—è—Ç—å —Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏{% else %}–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å{% endif %}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ç—å—é "{{ content.title }}"?</p>
                <p class="text-danger"><strong>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!</strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <form method="POST" action="{{ url_for('admin_mama_content_delete', content_id=content.id) }}" style="display: inline;">
                    <button type="submit" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function deleteContent() {
    $('#deleteModal').modal('show');
}

function duplicateContent() {
    if (confirm('–°–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é —ç—Ç–æ–π —Å—Ç–∞—Ç—å–∏?')) {
        // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é —Å –ø–æ–º–µ—Ç–∫–æ–π "–ö–æ–ø–∏—è"
        const title = document.getElementById('title').value + ' (–ö–æ–ø–∏—è)';
        const content = document.getElementById('content').value;
        const category = document.getElementById('category').value;
        const trimester = document.getElementById('trimester').value;
        const difficulty_level = document.getElementById('difficulty_level').value;
        const duration = document.getElementById('duration').value;
        const author = document.getElementById('author').value;
        const image_url = document.getElementById('image_url').value;
        const video_url = document.getElementById('video_url').value;
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç–∞—Ç—å–∏
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("admin_mama_content_add") }}';
        
        const fields = {
            'title': title,
            'content': content,
            'category': category,
            'trimester': trimester,
            'difficulty_level': difficulty_level,
            'duration': duration,
            'author': author,
            'image_url': image_url,
            'video_url': video_url
        };
        
        for (const [key, value] of Object.entries(fields)) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            input.value = value;
            form.appendChild(input);
        }
        
        document.body.appendChild(form);
        form.submit();
    }
}

function previewContent() {
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
    const content = document.getElementById('content').value;
    const title = document.getElementById('title').value;
    
    const newWindow = window.open('', '_blank');
    newWindow.document.write(`
        <html>
        <head>
            <title>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä: ${title}</title>
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" rel="stylesheet">
        </head>
        <body>
            <div class="container mt-4">
                <h1>${title}</h1>
                <div class="content">
                    ${content.replace(/\n/g, '<br>')}
                </div>
            </div>
        </body>
        </html>
    `);
}

function togglePublish() {
    const checkbox = document.getElementById('is_published');
    checkbox.checked = !checkbox.checked;
    
    const button = event.target;
    if (checkbox.checked) {
        button.innerHTML = '<i class="fas fa-toggle-on"></i> –°–Ω—è—Ç—å —Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏';
        button.className = 'btn btn-outline-warning mb-2';
    } else {
        button.innerHTML = '<i class="fas fa-toggle-off"></i> –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å';
        button.className = 'btn btn-outline-success mb-2';
    }
}
</script>
{% endblock %}
