{% extends "base.html" %}

{% block title %}UMAY - Восстановление доступа{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 relative overflow-hidden">
  <div class="relative z-10 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-white/10 backdrop-blur-lg rounded-3xl p-8 border border-white/20 shadow-2xl animate-scale-in">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-white mb-2">Восстановление доступа</h2>
        <p class="text-gray-300">Получите SMS-код и задайте новый пароль</p>
      </div>

      <form method="POST" class="space-y-6">
        <div class="group">
          <label class="block text-sm font-semibold text-gray-300 mb-3 group-focus-within:text-pink-400 transition-colors">
            <i class="fas fa-phone mr-2"></i>Телефон
          </label>
          <div class="flex space-x-2">
            <input type="tel" name="phone" id="recover_phone" required placeholder="+7 7XX XXX XX XX"
                   class="flex-1 px-6 py-4 bg-white/10 border-2 border-white/20 rounded-2xl text-white placeholder-gray-400 focus:border-pink-400 focus:bg-white/20 transition-all duration-300 text-lg backdrop-blur-lg" />
            <button type="button" id="recover_send_code" class="px-4 py-4 bg-pink-600 hover:bg-pink-700 text-white rounded-2xl">Код</button>
          </div>
          <p id="recover_phone_hint" class="text-sm text-gray-400 mt-1">Введите номер и нажмите «Код», чтобы получить SMS.</p>
        </div>

        <div class="group">
          <label class="block text-sm font-semibold text-gray-300 mb-3 group-focus-within:text-pink-400 transition-colors">
            <i class="fas fa-key mr-2"></i>Код из SMS
          </label>
          <input type="text" name="otp_code" id="recover_otp" required placeholder="6 цифр"
                 class="w-full px-6 py-4 bg-white/10 border-2 border-white/20 rounded-2xl text-white placeholder-gray-400 focus:border-pink-400 focus:bg-white/20 transition-all duration-300 text-lg backdrop-blur-lg" />
        </div>

        <div class="group">
          <label class="block text-sm font-semibold text-gray-300 mb-3 group-focus-within:text-pink-400 transition-colors">
            <i class="fas fa-lock mr-2"></i>Новый пароль
          </label>
          <input type="password" name="new_password" required placeholder="Минимум 6 символов"
                 class="w-full px-6 py-4 bg-white/10 border-2 border-white/20 rounded-2xl text-white placeholder-gray-400 focus:border-pink-400 focus:bg-white/20 transition-all duration-300 text-lg backdrop-blur-lg" />
        </div>

        <div class="group">
          <label class="block text-sm font-semibold text-gray-300 mb-3 group-focus-within:text-pink-400 transition-colors">
            <i class="fas fa-lock mr-2"></i>Подтвердите пароль
          </label>
          <input type="password" name="confirm_password" required placeholder="Повторите пароль"
                 class="w-full px-6 py-4 bg-white/10 border-2 border-white/20 rounded-2xl text-white placeholder-gray-400 focus:border-pink-400 focus:bg-white/20 transition-all duration-300 text-lg backdrop-blur-lg" />
        </div>

        <button type="submit" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-5 px-8 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-2xl flex items-center justify-center space-x-3 text-xl group">
          <i class="fas fa-sync-alt group-hover:animate-pulse"></i>
          <span>Обновить пароль</span>
        </button>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const btn = document.getElementById('recover_send_code');
  const phoneInput = document.getElementById('recover_phone');
  const hint = document.getElementById('recover_phone_hint');
  if (btn && phoneInput) {
    btn.addEventListener('click', async function() {
      const phone = phoneInput.value.trim();
      if (!phone) {
        hint && (hint.textContent = 'Введите номер телефона');
        return;
      }
      btn.disabled = true;
      const prevText = btn.textContent;
      btn.textContent = 'Отправка...';
      try {
        const resp = await fetch('/api/otp/send', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ phone: phone, purpose: 'reset' })
        });
        const data = await resp.json();
        if (data.status === 'success') {
          hint && (hint.textContent = 'Код отправлен. Проверьте SMS.');
          btn.textContent = 'Отправлено';
          setTimeout(() => { btn.disabled = false; btn.textContent = prevText; }, 60000);
        } else {
          hint && (hint.textContent = data.message || 'Ошибка отправки');
          btn.disabled = false; btn.textContent = prevText;
        }
      } catch (e) {
        hint && (hint.textContent = 'Ошибка сети');
        btn.disabled = false; btn.textContent = prevText;
      }
    });
  }
});
</script>
{% endblock %}

