{% extends "admin/base.html" %}

{% block title %}–ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="fas fa-eye"></i> –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h1>
        <div>
            <span class="badge badge-warning badge-pill">{{ pending_content|length }} —Å—Ç–∞—Ç–µ–π –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</span>
            <a href="{{ url_for('admin_mama_content') }}" class="btn btn-secondary ml-2">
                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏
            </a>
        </div>
    </div>

    {% if pending_content %}
    <!-- –°—Ç–∞—Ç—å–∏ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
    <div class="row">
        {% for content in pending_content %}
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            {% if content.category == 'sport' %}üèÉ –°–ø–æ—Ä—Ç
                            {% elif content.category == 'nutrition' %}üçé –ü–∏—Ç–∞–Ω–∏–µ
                            {% elif content.category == 'vitamins' %}üíä –í–∏—Ç–∞–º–∏–Ω—ã
                            {% elif content.category == 'body_care' %}üíÖ –£—Ö–æ–¥ –∑–∞ —Ç–µ–ª–æ–º
                            {% elif content.category == 'baby_care' %}üë∂ –£—Ö–æ–¥ –∑–∞ –º–∞–ª—ã—à–æ–º
                            {% elif content.category == 'doctor_advice' %}üë®‚Äç‚öïÔ∏è –°–æ–≤–µ—Ç—ã –≤—Ä–∞—á–µ–π
                            {% else %}{{ content.category }}
                            {% endif %}
                        </h5>
                        <span class="badge badge-warning">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</span>
                    </div>
                </div>
                <div class="card-body">
                    <h6 class="card-title">{{ content.title }}</h6>
                    <p class="card-text">{{ content.content[:200] }}{% if content.content|length > 200 %}...{% endif %}</p>
                    
                    <div class="meta-info mb-3">
                        {% if content.trimester %}
                        <span class="badge badge-info">–¢—Ä–∏–º–µ—Å—Ç—Ä: {{ content.trimester }}</span>
                        {% endif %}
                        {% if content.difficulty_level %}
                        <span class="badge badge-secondary">–°–ª–æ–∂–Ω–æ—Å—Ç—å: {{ content.difficulty_level }}</span>
                        {% endif %}
                        {% if content.duration %}
                        <span class="badge badge-success">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {{ content.duration }}</span>
                        {% endif %}
                    </div>
                    
                    <div class="author-info mb-3">
                        <small class="text-muted">
                            <i class="fas fa-user"></i> –ê–≤—Ç–æ—Ä: {{ content.author }}
                            <br>
                            <i class="fas fa-clock"></i> –°–æ–∑–¥–∞–Ω–æ: {{ content.created_at.strftime('%d.%m.%Y %H:%M') }}
                        </small>
                    </div>
                    
                    <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                    <div class="btn-group w-100" role="group">
                        <button type="button" class="btn btn-success" 
                                onclick="approveContent({{ content.id }})">
                            <i class="fas fa-check"></i> –û–¥–æ–±—Ä–∏—Ç—å
                        </button>
                        <button type="button" class="btn btn-danger" 
                                onclick="rejectContent({{ content.id }})">
                            <i class="fas fa-times"></i> –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                        </button>
                        <a href="{{ url_for('admin_mama_content_edit', content_id=content.id) }}" 
                           class="btn btn-primary">
                            <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </a>
                        <button type="button" class="btn btn-info" 
                                onclick="previewContent({{ content.id }})">
                            <i class="fas fa-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- –ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-tasks"></i> –ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
                </div>
                <div class="card-body">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-success" onclick="approveAll()">
                            <i class="fas fa-check-double"></i> –û–¥–æ–±—Ä–∏—Ç—å –≤—Å–µ
                        </button>
                        <button type="button" class="btn btn-danger" onclick="rejectAll()">
                            <i class="fas fa-times-circle"></i> –û—Ç–∫–ª–æ–Ω–∏—Ç—å –≤—Å–µ
                        </button>
                        <button type="button" class="btn btn-info" onclick="exportPending()">
                            <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <!-- –ù–µ—Ç —Å—Ç–∞—Ç–µ–π –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center py-5">
                    <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                    <h4>–û—Ç–ª–∏—á–Ω–æ! –ù–µ—Ç —Å—Ç–∞—Ç–µ–π –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h4>
                    <p class="text-muted">–í—Å–µ —Å—Ç–∞—Ç—å–∏ —É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –æ–¥–æ–±—Ä–µ–Ω—ã.</p>
                    <a href="{{ url_for('admin_mama_content_generate') }}" class="btn btn-success">
                        <i class="fas fa-magic"></i> –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="previewModalTitle">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—å–∏</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" id="previewModalBody">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" id="approveBtn">
                    <i class="fas fa-check"></i> –û–¥–æ–±—Ä–∏—Ç—å
                </button>
                <button type="button" class="btn btn-danger" id="rejectBtn">
                    <i class="fas fa-times"></i> –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                </button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<script>
let currentContentId = null;

function approveContent(contentId) {
    if (confirm('–û–¥–æ–±—Ä–∏—Ç—å —ç—Ç—É —Å—Ç–∞—Ç—å—é?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `{{ url_for('admin_mama_content_approve', content_id=0) }}`.replace('0', contentId);
        document.body.appendChild(form);
        form.submit();
    }
}

function rejectContent(contentId) {
    if (confirm('–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç–∞—Ç—å—é?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `{{ url_for('admin_mama_content_reject', content_id=0) }}`.replace('0', contentId);
        document.body.appendChild(form);
        form.submit();
    }
}

function previewContent(contentId) {
    currentContentId = contentId;
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    $('#previewModal').modal('show');
}

function approveAll() {
    if (confirm('–û–¥–æ–±—Ä–∏—Ç—å –≤—Å–µ —Å—Ç–∞—Ç—å–∏ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏?')) {
        // –ú–∞—Å—Å–æ–≤–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ
        const checkboxes = document.querySelectorAll('input[name="content_ids"]:checked');
        const ids = Array.from(checkboxes).map(cb => cb.value);
        
        if (ids.length > 0) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '{{ url_for("admin_mama_content_approve", content_id=0) }}';
            // –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è
        }
    }
}

function rejectAll() {
    if (confirm('–û—Ç–∫–ª–æ–Ω–∏—Ç—å –≤—Å–µ —Å—Ç–∞—Ç—å–∏ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏?')) {
        // –ú–∞—Å—Å–æ–≤–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
    }
}

function exportPending() {
    // –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–µ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    window.open('{{ url_for("admin_mama_content") }}?export=pending', '_blank');
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
document.getElementById('approveBtn').addEventListener('click', function() {
    if (currentContentId) {
        approveContent(currentContentId);
        $('#previewModal').modal('hide');
    }
});

document.getElementById('rejectBtn').addEventListener('click', function() {
    if (currentContentId) {
        rejectContent(currentContentId);
        $('#previewModal').modal('hide');
    }
});
</script>
{% endblock %}
