{% extends "admin/base.html" %}

{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="fas fa-chart-line"></i> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h1>
        <a href="{{ url_for('admin_mama_content') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏
        </a>
    </div>

    <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">{{ category_stats|sum(attribute='count') }}</h4>
                            <p class="card-text">–í—Å–µ–≥–æ —Å—Ç–∞—Ç–µ–π</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-file-alt fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">{{ popular_content|sum(attribute='views') }}</h4>
                            <p class="card-text">–û–±—â–∏—Ö –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-eye fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">{{ category_stats|length }}</h4>
                            <p class="card-text">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-tags fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">
                                {% if popular_content %}
                                {{ "%.1f"|format(popular_content|sum(attribute='views') / popular_content|length) }}
                                {% else %}
                                0
                                {% endif %}
                            </h4>
                            <p class="card-text">–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Å–º–æ—Ç—Ä</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-chart-bar fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
    <div class="row mb-4">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-chart-pie"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h5>
                </div>
                <div class="card-body">
                    {% if category_stats %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                    <th>–°—Ç–∞—Ç–µ–π</th>
                                    <th>–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Å–º–æ—Ç—Ä</th>
                                    <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stat in category_stats %}
                                <tr>
                                    <td>
                                        {% if stat.category == 'sport' %}üèÉ –°–ø–æ—Ä—Ç
                                        {% elif stat.category == 'nutrition' %}üçé –ü–∏—Ç–∞–Ω–∏–µ
                                        {% elif stat.category == 'vitamins' %}üíä –í–∏—Ç–∞–º–∏–Ω—ã
                                        {% elif stat.category == 'body_care' %}üíÖ –£—Ö–æ–¥ –∑–∞ —Ç–µ–ª–æ–º
                                        {% elif stat.category == 'baby_care' %}üë∂ –£—Ö–æ–¥ –∑–∞ –º–∞–ª—ã—à–æ–º
                                        {% elif stat.category == 'doctor_advice' %}üë®‚Äç‚öïÔ∏è –°–æ–≤–µ—Ç—ã –≤—Ä–∞—á–µ–π
                                        {% else %}{{ stat.category }}
                                        {% endif %}
                                    </td>
                                    <td>{{ stat.count }}</td>
                                    <td>{{ "%.1f"|format(stat.avg_views or 0) }}</td>
                                    <td>
                                        {% set total = category_stats|sum(attribute='count') %}
                                        {{ "%.1f"|format(stat.count / total * 100) }}%
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç—Ä–∏–º–µ—Å—Ç—Ä–∞–º -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç—Ä–∏–º–µ—Å—Ç—Ä–∞–º</h5>
                </div>
                <div class="card-body">
                    {% if trimester_stats %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>–¢—Ä–∏–º–µ—Å—Ç—Ä</th>
                                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–µ–π</th>
                                    <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stat in trimester_stats %}
                                <tr>
                                    <td>
                                        {% if stat.trimester == '1' %}1 —Ç—Ä–∏–º–µ—Å—Ç—Ä (1-12 –Ω–µ–¥–µ–ª—è)
                                        {% elif stat.trimester == '2' %}2 —Ç—Ä–∏–º–µ—Å—Ç—Ä (13-27 –Ω–µ–¥–µ–ª—è)
                                        {% elif stat.trimester == '3' %}3 —Ç—Ä–∏–º–µ—Å—Ç—Ä (28-40 –Ω–µ–¥–µ–ª—è)
                                        {% elif stat.trimester == 'all' %}–õ—é–±–æ–π —Ç—Ä–∏–º–µ—Å—Ç—Ä
                                        {% else %}{{ stat.trimester }}
                                        {% endif %}
                                    </td>
                                    <td>{{ stat.count }}</td>
                                    <td>
                                        {% set total = trimester_stats|sum(attribute='count') %}
                                        {{ "%.1f"|format(stat.count / total * 100) }}%
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-star"></i> –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç–∞—Ç—å–∏</h5>
                </div>
                <div class="card-body">
                    {% if popular_content %}
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                    <th>–¢—Ä–∏–º–µ—Å—Ç—Ä</th>
                                    <th>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</th>
                                    <th>–ê–≤—Ç–æ—Ä</th>
                                    <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for content in popular_content %}
                                <tr>
                                    <td>
                                        <strong>{{ content.title }}</strong>
                                    </td>
                                    <td>
                                        {% if content.category == 'sport' %}üèÉ –°–ø–æ—Ä—Ç
                                        {% elif content.category == 'nutrition' %}üçé –ü–∏—Ç–∞–Ω–∏–µ
                                        {% elif content.category == 'vitamins' %}üíä –í–∏—Ç–∞–º–∏–Ω—ã
                                        {% elif content.category == 'body_care' %}üíÖ –£—Ö–æ–¥ –∑–∞ —Ç–µ–ª–æ–º
                                        {% elif content.category == 'baby_care' %}üë∂ –£—Ö–æ–¥ –∑–∞ –º–∞–ª—ã—à–æ–º
                                        {% elif content.category == 'doctor_advice' %}üë®‚Äç‚öïÔ∏è –°–æ–≤–µ—Ç—ã –≤—Ä–∞—á–µ–π
                                        {% else %}{{ content.category }}
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if content.trimester == '1' %}1 —Ç—Ä–∏–º–µ—Å—Ç—Ä
                                        {% elif content.trimester == '2' %}2 —Ç—Ä–∏–º–µ—Å—Ç—Ä
                                        {% elif content.trimester == '3' %}3 —Ç—Ä–∏–º–µ—Å—Ç—Ä
                                        {% elif content.trimester == 'all' %}–õ—é–±–æ–π
                                        {% else %}{{ content.trimester }}
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge badge-info">{{ content.views }}</span>
                                    </td>
                                    <td>{{ content.author }}</td>
                                    <td>{{ content.created_at.strftime('%d.%m.%Y') }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">–ù–µ—Ç –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-calendar"></i> –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º</h5>
                </div>
                <div class="card-body">
                    {% if recent_stats %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–°–æ–∑–¥–∞–Ω–æ —Å—Ç–∞—Ç–µ–π</th>
                                    <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stat in recent_stats %}
                                <tr>
                                    <td>{{ stat.date.strftime('%d.%m.%Y') }}</td>
                                    <td>{{ stat.count }}</td>
                                    <td>
                                        <div class="progress" style="height: 20px;">
                                            {% set max_count = recent_stats|max(attribute='count') %}
                                            <div class="progress-bar" role="progressbar" 
                                                 style="width: {{ (stat.count / max_count * 100)|round }}%">
                                                {{ stat.count }}
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-lightbulb"></i> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-plus-circle text-success"></i> –ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:</h6>
                            <ul>
                                {% if category_stats|selectattr('category', 'equalto', 'sport')|list|length == 0 %}
                                <li>–ë–æ–ª—å—à–µ —Å—Ç–∞—Ç–µ–π –æ —Å–ø–æ—Ä—Ç–µ –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è—Ö</li>
                                {% endif %}
                                {% if category_stats|selectattr('category', 'equalto', 'nutrition')|list|length == 0 %}
                                <li>–°—Ç–∞—Ç—å–∏ –æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–∏—Ç–∞–Ω–∏–∏</li>
                                {% endif %}
                                {% if category_stats|selectattr('category', 'equalto', 'vitamins')|list|length == 0 %}
                                <li>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏—Ç–∞–º–∏–Ω–∞—Ö –∏ –¥–æ–±–∞–≤–∫–∞—Ö</li>
                                {% endif %}
                                <li>–í–∏–¥–µ–æ-–∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è</li>
                                <li>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —á–µ–∫-–ª–∏—Å—Ç—ã</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-chart-line text-info"></i> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞:</h6>
                            <ul>
                                <li>–°–∞–º–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è: 
                                    {% if category_stats %}
                                    {% set most_popular = category_stats|max(attribute='count') %}
                                    {% for stat in category_stats %}
                                        {% if stat.count == most_popular.count %}
                                            {% if stat.category == 'sport' %}–°–ø–æ—Ä—Ç
                                            {% elif stat.category == 'nutrition' %}–ü–∏—Ç–∞–Ω–∏–µ
                                            {% elif stat.category == 'vitamins' %}–í–∏—Ç–∞–º–∏–Ω—ã
                                            {% elif stat.category == 'body_care' %}–£—Ö–æ–¥ –∑–∞ —Ç–µ–ª–æ–º
                                            {% elif stat.category == 'baby_care' %}–£—Ö–æ–¥ –∑–∞ –º–∞–ª—ã—à–æ–º
                                            {% elif stat.category == 'doctor_advice' %}–°–æ–≤–µ—Ç—ã –≤—Ä–∞—á–µ–π
                                            {% else %}{{ stat.category }}
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                    {% else %}–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö{% endif %}
                                </li>
                                <li>–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: 
                                    {% if popular_content %}
                                    {{ "%.1f"|format(popular_content|sum(attribute='views') / popular_content|length) }}
                                    {% else %}0{% endif %}
                                </li>
                                <li>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è 2-3 —Ç—Ä–∏–º–µ—Å—Ç—Ä–æ–≤</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
